<!DOCTYPE html>
<html>
<head>
<meta charset="UTF-8">
<title>SISTEM GUDANG PT SAMUDRA MANDIRI SENTOSA</title>

<script src="https://www.gstatic.com/firebasejs/8.10.0/firebase-app.js"></script>
<script src="https://www.gstatic.com/firebasejs/8.10.0/firebase-database.js"></script>

<style>
body{font-family:Arial;margin:20px;background:#f4f6f9}
h2{margin-top:40px}
input,select{padding:6px;margin:4px}
button{padding:6px 12px;background:#2e7d32;color:white;border:none;cursor:pointer}
button:hover{background:#1b5e20}
table{width:100%;border-collapse:collapse;margin-top:10px;background:white}
th,td{border:1px solid #ccc;padding:6px;text-align:left}
th{background:#2e7d32;color:white}
</style>
</head>

<body>

<h1>SISTEM GUDANG PT SAMUDRA MANDIRI SENTOSA</h1>

<h2>Master Barang</h2>
<input type="text" id="kode" placeholder="Kode Barang">
<input type="text" id="nama" placeholder="Nama Barang">
<input type="text" id="foto" placeholder="Link Foto (optional)">
<button onclick="tambahBarang()">Tambah Barang</button>

<h2>Barang Masuk</h2>
<input type="text" id="kodeMasuk" placeholder="Kode Barang">
<input type="number" id="qtyMasuk" placeholder="Qty">
<select id="departemen">
<option value="">Pilih Departemen</option>
<option>Produksi</option>
<option>Gudang</option>
<option>Tambak</option>
<option>Office</option>
</select>
<label><input type="checkbox" id="stokCheck"> Masuk Stok</label>
<button onclick="barangMasuk()">Proses</button>

<h2>Riwayat Transaksi</h2>
<table>
<thead>
<tr>
<th>Tanggal</th>
<th>Kode</th>
<th>Nama</th>
<th>Qty</th>
<th>Departemen</th>
<th>Masuk Stok</th>
</tr>
</thead>
<tbody id="riwayat"></tbody>
</table>

<script>

var firebaseConfig = {
 apiKey: "AIzaSyAucO3yaRtvL-v9zCK_6-ThNJVT-kRF3jg",
    authDomain: "gudang-anto-2026.firebaseapp.com",
    databaseURL: "https://gudang-anto-2026-default-rtdb.asia-southeast1.firebasedatabase.app",
    projectId: "gudang-anto-2026",
    storageBucket: "gudang-anto-2026.firebasestorage.app",
    messagingSenderId: "711961129196",
    appId: "1:711961129196:web:7e2d2e74539e112dfff5c9"
};

firebase.initializeApp(firebaseConfig);
var db = firebase.database();

function tambahBarang(){
var kode=document.getElementById("kode").value;
var nama=document.getElementById("nama").value;
var foto=document.getElementById("foto").value;

if(kode==""||nama==""){alert("Lengkapi data");return;}

db.ref("masterBarang/"+kode).set({
kode:kode,
nama:nama,
foto:foto||""
});

alert("Barang ditambahkan");
}

function barangMasuk(){
var kode=document.getElementById("kodeMasuk").value;
var qty=document.getElementById("qtyMasuk").value;
var dept=document.getElementById("departemen").value;
var stok=document.getElementById("stokCheck").checked;

if(kode==""||qty==""){alert("Lengkapi data");return;}

db.ref("masterBarang/"+kode).once("value",function(snap){
if(!snap.exists()){alert("Kode tidak ditemukan");return;}

var data=snap.val();

var transaksi={
tanggal:new Date().toLocaleString(),
kode:kode,
nama:data.nama,
qty:qty,
departemen:dept,
stok:stok?"Yes":"No"
};

db.ref("transaksi").push(transaksi);

if(stok){
db.ref("stok/"+kode).once("value",function(s){
var lama=s.val()||0;
db.ref("stok/"+kode).set(parseInt(lama)+parseInt(qty));
});
}

alert("Transaksi berhasil");
});
}

db.ref("transaksi").on("value",function(snapshot){
var html="";
snapshot.forEach(function(child){
var d=child.val();
html+="<tr>";
html+="<td>"+d.tanggal+"</td>";
html+="<td>"+d.kode+"</td>";
html+="<td>"+d.nama+"</td>";
html+="<td>"+d.qty+"</td>";
html+="<td>"+d.departemen+"</td>";
html+="<td>"+d.stok+"</td>";
html+="</tr>";
});
document.getElementById("riwayat").innerHTML=html;
});
// LOAD MASTER BARANG KE SELECT KELUAR
firebase.database().ref("master_barang").on("value", function(snapshot){
    const select = document.getElementById("keluarKode");
    select.innerHTML = "";
    snapshot.forEach(function(child){
        const data = child.val();
        select.innerHTML += <option value="${child.key}">${child.key} - ${data.nama}</option>;
    });
});

// LOAD DEPARTEMEN
firebase.database().ref("departemen").on("value", function(snapshot){
    const select = document.getElementById("keluarDepartemen");
    select.innerHTML = "";
    snapshot.forEach(function(child){
        select.innerHTML += <option value="${child.val().nama}">${child.val().nama}</option>;
    });
});

function barangKeluar(){

    const kode = document.getElementById("keluarKode").value;
    const qty = parseFloat(document.getElementById("keluarQty").value);
    const departemen = document.getElementById("keluarDepartemen").value;

    if(!kode || !qty){
        alert("Lengkapi data");
        return;
    }

    const stokRef = firebase.database().ref("stok/" + kode);

    stokRef.once("value", function(snapshot){

        const stokSekarang = snapshot.val() ? snapshot.val().qty : 0;

        if(stokSekarang < qty){
            alert("Stok tidak cukup!");
            return;
        }

        const stokBaru = stokSekarang - qty;

        // Update stok
        stokRef.set({
            qty: stokBaru
        });

        // Simpan riwayat
        firebase.database().ref("riwayat").push({
            tanggal: new Date().toLocaleString(),
            kode: kode,
            qty: qty,
            tipe: "Keluar",
            departemen: departemen
        });

        alert("Barang keluar berhasil");
        document.getElementById("keluarQty").value = "";
    });
}
</script>

</body>
</html>