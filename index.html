<!DOCTYPE html>
<html>
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>Sistem Gudang PT Samudra Mandiri Sentosa</title>

<!-- Firebase -->
<script src="https://www.gstatic.com/firebasejs/8.10.1/firebase-app.js"></script>
<script src="https://www.gstatic.com/firebasejs/8.10.1/firebase-database.js"></script>

<!-- Chart -->
<script src="https://cdn.jsdelivr.net/npm/chart.js"></script>

<!-- Excel -->
<script src="https://cdnjs.cloudflare.com/ajax/libs/xlsx/0.18.5/xlsx.full.min.js"></script>

<style>
body{font-family:Arial;background:#f4f6f9;margin:20px}
h2{background:#003366;color:white;padding:10px}
.card{background:white;padding:15px;margin-bottom:20px;border-radius:8px}
input,select,button{padding:6px;margin:4px}
table{width:100%;border-collapse:collapse}
th,td{border:1px solid #ddd;padding:6px;text-align:center}
th{background:#003366;color:white}
.warning{background:#ffcccc}
img{width:40px}
</style>
</head>
<body>

<h2>SISTEM GUDANG PT SAMUDRA MANDIRI SENTOSA</h2>

<div class="card">
<h3>Master Barang</h3>
<input id="m_kode" placeholder="Kode Barang">
<input id="m_nama" placeholder="Nama Barang">
<input id="m_unit" placeholder="Unit">
<input id="m_minimum" type="number" placeholder="Minimum Stok">
<input id="m_foto" placeholder="Link Foto">
<button onclick="tambahMasterBarang()">Tambah</button>
<table>
<thead>
<tr>
<th>Kode</th><th>Nama</th><th>Unit</th><th>Min</th><th>Foto</th><th>Aksi</th>
</tr>
</thead>
<tbody id="masterBarangTable"></tbody>
</table>
</div>

<div class="card">
<h3>Master Departemen</h3>
<input id="d_nama" placeholder="Nama Departemen">
<button onclick="tambahDepartemen()">Tambah</button>
<table>
<thead><tr><th>Nama</th><th>Aksi</th></tr></thead>
<tbody id="departemenTable"></tbody>
</table>
</div>

<div class="card">
<h3>Barang Masuk</h3>
<select id="bm_kode"></select>
<select id="bm_kategori">
<option value="Stok">Masuk Stok</option>
<option value="Transit">Transit (Langsung Pakai)</option>
</select>
<select id="bm_gudang">
<option value="">Pilih Gudang</option>
<option>Gudang Ingredients</option>
<option>Gudang Label</option>
<option>Gudang ATK</option>
<option>General Store A</option>
<option>General Store B</option>
<option>Gudang Tambak</option>
</select>
<select id="bm_departemen">
<option value="">Pilih Departemen</option>
</select>
<input id="bm_qty" type="number" placeholder="Qty">
<button onclick="barangMasuk()">Proses</button>
</div>

<div class="card">
<h3>Barang Keluar</h3>
<select id="bk_kode"></select>
<select id="bk_gudang">
<option>Gudang Ingredients</option>
<option>Gudang Label</option>
<option>Gudang ATK</option>
<option>General Store A</option>
<option>General Store B</option>
<option>Gudang Tambak</option>
</select>
<input id="bk_qty" type="number" placeholder="Qty">
<button onclick="barangKeluar()">Proses</button>
</div>

<div class="card">
<h3>Stok Gudang</h3>
<table>
<thead>
<tr><th>Gudang</th><th>Kode</th><th>Stok</th></tr>
</thead>
<tbody id="stokTable"></tbody>
</table>
</div>

<div class="card">
<h3>Grafik Total Stok per Gudang</h3>
<canvas id="chart"></canvas>
</div>

<div class="card">
<h3>Riwayat Transaksi</h3>
<button onclick="exportExcel()">Export Excel</button>
<table>
<thead>
<tr>
<th>Tanggal</th><th>Tipe</th><th>Kategori</th>
<th>Gudang</th><th>Departemen</th>
<th>Kode</th><th>Qty</th><th>Aksi</th>
</tr>
</thead>
<tbody id="riwayatTable"></tbody>
</table>
</div>

<script>

// =================== GANTI DENGAN FIREBASE ANDA ===================
var firebaseConfig = {
 apiKey: "AIzaSyAucO3yaRtvL-v9zCK_6-ThNJVT-kRF3jg",
    authDomain: "gudang-anto-2026.firebaseapp.com",
    databaseURL: "https://gudang-anto-2026-default-rtdb.asia-southeast1.firebasedatabase.app",
    projectId: "gudang-anto-2026",
    storageBucket: "gudang-anto-2026.firebasestorage.app",
    messagingSenderId: "711961129196",
    appId: "1:711961129196:web:7e2d2e74539e112dfff5c9"
};
// ================================================================

firebase.initializeApp(firebaseConfig);
var db = firebase.database();

// MASTER BARANG
function tambahMasterBarang(){
if(!m_kode.value||!m_nama.value)return alert("Lengkapi data");
db.ref("master_barang/"+m_kode.value).set({
nama:m_nama.value,
unit:m_unit.value,
minimum:Number(m_minimum.value||0),
foto:m_foto.value||""
});
m_kode.value="";m_nama.value="";m_unit.value="";
m_minimum.value="";m_foto.value="";
}

function hapusMasterBarang(k){
if(confirm("Hapus?")) db.ref("master_barang/"+k).remove();
}

function loadMasterBarang(){
db.ref("master_barang").on("value",snap=>{
masterBarangTable.innerHTML="";
bm_kode.innerHTML=""; bk_kode.innerHTML="";
snap.forEach(c=>{
let k=c.key,d=c.val();
masterBarangTable.innerHTML+=`
<tr>
<td>${k}</td>
<td>${d.nama}</td>
<td>${d.unit}</td>
<td>${d.minimum}</td>
<td>${d.foto?'<img src="'+d.foto+'">':'-'}</td>
<td><button onclick="hapusMasterBarang('${k}')">Hapus</button></td>
</tr>`;
bm_kode.innerHTML+=<option value="${k}">${k} - ${d.nama}</option>;
bk_kode.innerHTML+=<option value="${k}">${k} - ${d.nama}</option>;
});
});
}

// DEPARTEMEN
function tambahDepartemen(){
if(!d_nama.value)return;
db.ref("departemen").push({nama:d_nama.value});
d_nama.value="";
}

function hapusDepartemen(k){
if(confirm("Hapus?")) db.ref("departemen/"+k).remove();
}

function loadDepartemen(){
db.ref("departemen").on("value",snap=>{
departemenTable.innerHTML="";
bm_departemen.innerHTML="<option value=''>Pilih Departemen</option>";
snap.forEach(c=>{
let k=c.key,d=c.val();
departemenTable.innerHTML+=`
<tr>
<td>${d.nama}</td>
<td><button onclick="hapusDepartemen('${k}')">Hapus</button></td>
</tr>`;
bm_departemen.innerHTML+=<option value="${d.nama}">${d.nama}</option>;
});
});
}

// BARANG MASUK
function barangMasuk(){
let kode=bm_kode.value;
let kategori=bm_kategori.value;
let gudang=bm_gudang.value;
let dept=bm_departemen.value;
let qty=Number(bm_qty.value);
if(!kode||!qty)return alert("Lengkapi data");

let data={
tanggal:new Date().toLocaleString(),
tipe:"Masuk",
kategori:kategori,
gudang:kategori=="Stok"?gudang:"",
departemen:kategori=="Transit"?dept:"",
kode:kode,
qty:qty
};

db.ref("transactions").push(data);

if(kategori=="Stok"){
db.ref("stok/"+gudang+"/"+kode)
.transaction(cur=>(cur||0)+qty);
}
bm_qty.value="";
}

// BARANG KELUAR
function barangKeluar(){
let kode=bk_kode.value;
let gudang=bk_gudang.value;
let qty=Number(bk_qty.value);
if(!kode||!qty)return alert("Lengkapi data");

let data={
tanggal:new Date().toLocaleString(),
tipe:"Keluar",
kategori:"Stok",
gudang:gudang,
departemen:"",
kode:kode,
qty:qty
};

db.ref("transactions").push(data);
db.ref("stok/"+gudang+"/"+kode)
.transaction(cur=>(cur||0)-qty);
bk_qty.value="";
}

// LOAD RIWAYAT + STOK
function loadRiwayat(){
db.ref("transactions").on("value",snap=>{
riwayatTable.innerHTML="";
let stok={};
snap.forEach(c=>{
let k=c.key,d=c.val();
riwayatTable.innerHTML+=`
<tr>
<td>${d.tanggal}</td>
<td>${d.tipe}</td>
<td>${d.kategori}</td>
<td>${d.gudang||"-"}</td>
<td>${d.departemen||"-"}</td>
<td>${d.kode}</td>
<td>${d.qty}</td>
<td><button onclick="hapusTransaksi('${k}')">Hapus</button></td>
</tr>`;
if(d.kategori=="Stok"){
if(!stok[d.gudang]) stok[d.gudang]={};
if(!stok[d.gudang][d.kode]) stok[d.gudang][d.kode]=0;
if(d.tipe=="Masuk") stok[d.gudang][d.kode]+=d.qty;
if(d.tipe=="Keluar") stok[d.gudang][d.kode]-=d.qty;
}
});
renderStok(stok);
});
}

function hapusTransaksi(k){
if(confirm("Hapus?")) db.ref("transactions/"+k).remove();
}

function renderStok(stok){
stokTable.innerHTML="";
let totalGudang={};
for(let g in stok){
for(let k in stok[g]){
stokTable.innerHTML+=`
<tr>
<td>${g}</td>
<td>${k}</td>
<td>${stok[g][k]}</td>
</tr>`;
if(!totalGudang[g]) totalGudang[g]=0;
totalGudang[g]+=stok[g][k];
}
}
updateChart(totalGudang);
}

var chart;
function updateChart(data){
let ctx=document.getElementById("chart").getContext("2d");
if(chart) chart.destroy();
chart=new Chart(ctx,{
type:"bar",
data:{labels:Object.keys(data),
datasets:[{label:"Total Stok",data:Object.values(data)}]}
});
}

function exportExcel(){
db.ref("transactions").once("value").then(snap=>{
let arr=[];
snap.forEach(c=>arr.push(c.val()));
let ws=XLSX.utils.json_to_sheet(arr);
let wb=XLSX.utils.book_new();
XLSX.utils.book_append_sheet(wb,ws,"Riwayat");
XLSX.writeFile(wb,"Riwayat_Transaksi.xlsx");
});
}

// INIT
loadMasterBarang();
loadDepartemen();
loadRiwayat();

</script>
</body>
</html>