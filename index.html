<!DOCTYPE html>
<html>
<head>
<meta charset="UTF-8">
<title>Sistem Gudang PT SMS - Ultimate Pro 2.0 Role-Based</title>

<script src="https://www.gstatic.com/firebasejs/8.10.0/firebase-app.js"></script>
<script src="https://www.gstatic.com/firebasejs/8.10.0/firebase-database.js"></script>
<script src="https://www.gstatic.com/firebasejs/8.10.0/firebase-auth.js"></script>
<script src="https://cdnjs.cloudflare.com/ajax/libs/xlsx/0.18.5/xlsx.full.min.js"></script>
<script src="https://cdn.jsdelivr.net/npm/chart.js"></script>
<script src="https://cdnjs.cloudflare.com/ajax/libs/jspdf/2.5.1/jspdf.umd.min.js"></script>

<style>
body{font-family:Arial,sans-serif;padding:15px;background:#f4f6f9;}
h2,h3{color:#2c3e50;}
input,select,button{padding:6px;margin:4px;}
button{background:#27ae60;color:white;border:none;cursor:pointer;}
button:hover{opacity:0.8;}
table{border-collapse:collapse;width:100%;background:white;margin-top:10px;}
th,td{border:1px solid #ccc;padding:6px;text-align:center;}
th{background:#34495e;color:white;}
.box{background:white;padding:15px;margin-bottom:20px;border-radius:6px;}
.warning{color:red;font-weight:bold;}
.popup{position:fixed;top:10px;right:10px;background:#e74c3c;color:white;padding:10px;border-radius:6px;z-index:1000;}
</style>
</head>
<body>

<h2>SISTEM GUDANG PT SAMUDRA MANDIRI SENTOSA</h2>

<!-- LOGIN -->
<div class="box">
<h3>Login</h3>
<input type="email" id="email" placeholder="Email">
<input type="password" id="password" placeholder="Password">
<button onclick="login()">Login</button>
<p id="loginStatus"></p>
</div>

<div id="mainApp" style="display:none;">

<!-- MASTER BARANG -->
<div class="box" id="masterBarangSection" style="display:none;">
<h3>Master Barang</h3>
<input id="kode" placeholder="Kode Barang">
<input id="nama" placeholder="Nama Barang">
<select id="unit">
<option>kg</option><option>pcs</option><option>box</option><option>roll</option><option>ball</option>
<option>dos</option><option>M3</option><option>liter</option><option>ton</option><option>tins</option>
<option>drum</option><option>sheet</option><option>ujung</option>
</select>
<input id="min" type="number" placeholder="Minimum Stok">
<select id="gudang">
<option>Ingredients</option>
<option>Label</option>
<option>ATK</option>
<option>General Store A</option>
<option>General Store B</option>
<option>Tambak</option>
</select>
<button onclick="tambahBarang()">Tambah Barang</button>
</div>

<!-- REQUEST DEPARTEMEN -->
<div class="box" id="requestSection" style="display:none;">
<h3>Request Barang Departemen</h3>
<select id="departemenRequest">
<option>Produksi</option>
<option>QC</option>
<option>Administrasi</option>
</select>
<input list="barangList" id="kodeRequest" placeholder="Kode Barang">
<datalist id="barangList"></datalist>
<input type="number" id="qtyRequest" placeholder="Qty">
<button onclick="buatRequest()">Buat Request</button>
</div>

<!-- BARANG MASUK -->
<div class="box" id="gudangSection" style="display:none;">
<h3>Barang Masuk / Stock</h3>
<input list="barangList" id="kodeMasuk" placeholder="Kode Barang">
<input type="number" id="qtyMasuk" placeholder="Qty">
<input placeholder="No PO" id="noPo">
<input placeholder="Supplier" id="supplier">
<input placeholder="Link Foto" id="fotoLink">
<select id="modeMasuk">
<option value="stock">Stock</option>
<option value="transit">Transit</option>
</select>
<button onclick="masuk()">Proses Masuk</button>
</div>

<!-- STOK GUDANG -->
<div class="box">
<h3>Stok Per Gudang</h3>
<button onclick="printDiv('stokTable')">Print Stok</button>
<button onclick="generatePDF('stokTable','Laporan Stok Gudang')">PDF Stok</button>
<table>
<thead>
<tr><th>Gudang</th><th>Kode</th><th>Nama</th><th>Unit</th><th>Stok</th><th>Status</th></tr>
</thead>
<tbody id="stokTable"></tbody>
</table>
<canvas id="stokChart" height="150"></canvas>
</div>

<!-- RIWAYAT -->
<div class="box">
<h3>Riwayat Transaksi</h3>
<input id="filterTanggal" placeholder="YYYY-MM-DD">
<select id="filterGudang">
<option value="">Semua Gudang</option>
<option>Ingredients</option>
<option>Label</option>
<option>ATK</option>
<option>General Store A</option>
<option>General Store B</option>
<option>Tambak</option>
</select>
<input id="filterKode" placeholder="Kode Barang">
<select id="filterTipe">
<option value="">Semua</option>
<option>Masuk</option>
<option>Keluar</option>
<option>Transit</option>
</select>
<button onclick="applyFilter()">Filter</button>
<button onclick="exportExcel()">Export Excel</button>
<button onclick="printDiv('riwayatTable')">Print Riwayat</button>
<button onclick="generatePDF('riwayatTable','Laporan Riwayat')">PDF Riwayat</button>
<table>
<thead>
<tr><th>Tanggal</th><th>Tipe</th><th>Gudang</th><th>Kode</th><th>Qty</th><th>User</th></tr>
</thead>
<tbody id="riwayatTable"></tbody>
</table>
</div>

<!-- PRS APPROVAL GM -->
<div class="box" id="gmSection" style="display:none;">
<h3>PRS Pending Approval GM</h3>
<table>
<thead>
<tr><th>No PRS</th><th>Withdrawal ID</th><th>Kode</th><th>Qty</th><th>Departemen</th><th>User</th><th>Status</th><th>Aksi</th></tr>
</thead>
<tbody id="prsTable"></tbody>
</table>
<button onclick="printDiv('prsTable')">Print PRS</button>
<button onclick="generatePDF('prsTable','Laporan PRS')">PDF PRS</button>
</div>

<div id="popupNotif" class="popup" style="display:none;">Stok Minimum!</div>

</div>

<script>
// ================= FIREBASE CONFIG =================
var firebaseConfig = {
 apiKey: "AIzaSyAucO3yaRtvL-v9zCK_6-ThNJVT-kRF3jg",
    authDomain: "gudang-anto-2026.firebaseapp.com",
    databaseURL: "https://gudang-anto-2026-default-rtdb.asia-southeast1.firebasedatabase.app",
    projectId: "gudang-anto-2026",
    storageBucket: "gudang-anto-2026.firebasestorage.app",
    messagingSenderId: "711961129196",
    appId: "1:711961129196:web:7e2d2e74539e112dfff5c9"
};
firebase.initializeApp(firebaseConfig);
var db=firebase.database();
var auth=firebase.auth();
var currentUser=null;
var role="";

// ================= LOGIN ROLE-BASED =================
function login(){
  var email = document.getElementById("email").value;
  var pass = document.getElementById("password").value;

  auth.signInWithEmailAndPassword(email, pass)
  .then(u => {
    currentUser = u.user;
    document.getElementById("loginStatus").innerText = "Login sukses: " + currentUser.email;
    document.getElementById("mainApp").style.display = "block";

    // Tentukan role
    if(email.includes("gm")) role = "gm";
    else if(email.includes("departemen")) role = "departemen";
    else role = "gudang";

    // Sembunyikan semua section
    document.getElementById("gudangSection").style.display = "none";
    document.getElementById("gmSection").style.display = "none";
    document.getElementById("requestSection").style.display = "none";
    document.getElementById("masterBarangSection").style.display = "none";

    // Tampilkan section sesuai role
    if(role == "gudang"){
      document.getElementById("masterBarangSection").style.display = "block";
      document.getElementById("gudangSection").style.display = "block";
    } else if(role == "departemen"){
      document.getElementById("requestSection").style.display = "block";
    } else if(role == "gm"){
      document.getElementById("gmSection").style.display = "block";
    }

    loadBarang();
    loadStok();
    loadRiwayat();
    loadPRS();
  })
  .catch(err => document.getElementById("loginStatus").innerText = err.message);
}

// ================= SCRIPT LAIN =================
// ... semua fungsi tambahBarang, buatRequest, masuk, loadStok, loadRiwayat, applyFilter, exportExcel, printDiv, generatePDF, loadPRS, approvePRS, rejectPRS tetap sama seperti sebelumnya ...
</script>

</body>
</html>