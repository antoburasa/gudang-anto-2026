<!DOCTYPE html>
<html>
<head>
<meta charset="UTF-8">
<title>Sistem Gudang Ultimate PRO PLUS 2.0</title>

<script src="https://cdn.tailwindcss.com"></script>
<script src="https://www.gstatic.com/firebasejs/8.10.1/firebase-app.js"></script>
<script src="https://www.gstatic.com/firebasejs/8.10.1/firebase-database.js"></script>

</head>
<body class="bg-gray-100 p-6">

<h1 class="text-2xl font-bold mb-4">SISTEM GUDANG ULTIMATE PRO PLUS 2.0</h1>

<!-- LOGIN -->
<div id="loginDiv" class="bg-white p-4 rounded shadow mb-4">
  <input id="username" placeholder="Username" class="border p-2 mr-2">
  <select id="roleSelect" class="border p-2 mr-2">
    <option value="admin">Admin</option>
    <option value="staff">Staff</option>
  </select>
  <button onclick="login()" class="bg-blue-500 text-white px-4 py-2 rounded">
    Login
  </button>
</div>

<!-- MAIN -->
<div id="mainDiv" style="display:none">

<div class="bg-white p-4 rounded shadow mb-4">
<h2 class="font-bold mb-2">Barang Masuk</h2>

<input id="kodeMasuk" placeholder="Kode Barang" class="border p-2 mr-2 mb-2">
<input id="itemMasuk" placeholder="Item" class="border p-2 mr-2 mb-2">
<input id="noRRMasuk" placeholder="No RR" class="border p-2 mr-2 mb-2">

<select id="unitMasuk" class="border p-2 mr-2 mb-2">
<option>kg</option><option>meter</option><option>roll</option>
<option>ball</option><option>dos</option><option>box</option>
<option>pcs</option><option>M3</option><option>liter</option>
<option>ton</option><option>tins</option><option>drum</option>
<option>sheet</option><option>ujung</option>
</select>

<input id="qtyMasuk" type="number" placeholder="Qty" class="border p-2 mr-2 mb-2">

<select id="gudangMasuk" class="border p-2 mr-2 mb-2">
<option value="Ingredients">Gudang Ingredients</option>
<option value="Label">Gudang Label</option>
<option value="ATK">Gudang ATK</option>
<option value="General A">General Store A</option>
<option value="General B">General Store B</option>
<option value="Tambak">Gudang Tambak</option>
</select>

<label class="mr-2">
<input type="checkbox" id="masukStok" checked> Masuk Stok
</label>

<br><br>
<button onclick="tambahMasuk()" class="bg-green-500 text-white px-4 py-2 rounded">
Tambah Barang Masuk
</button>

</div>

<!-- RIWAYAT -->
<div class="bg-white p-4 rounded shadow">
<h2 class="font-bold mb-2">Riwayat Transaksi</h2>

<table class="w-full border">
<thead>
<tr class="bg-gray-200">
<th class="border p-2">Tanggal</th>
<th class="border p-2">Gudang</th>
<th class="border p-2">Kode</th>
<th class="border p-2">Item</th>
<th class="border p-2">Qty</th>
<th class="border p-2">Masuk Stok</th>
<th class="border p-2">User</th>
</tr>
</thead>
<tbody id="tabelRiwayat"></tbody>
</table>

</div>
</div>

<script>

/* ==========================
   FIREBASE CONFIG
   GANTI DENGAN MILIK ANDA
========================== */

var firebaseConfig = {
 apiKey: "AIzaSyAucO3yaRtvL-v9zCK_6-ThNJVT-kRF3jg",
    authDomain: "gudang-anto-2026.firebaseapp.com",
    databaseURL: "https://gudang-anto-2026-default-rtdb.asia-southeast1.firebasedatabase.app",
    projectId: "gudang-anto-2026",
    storageBucket: "gudang-anto-2026.firebasestorage.app",
    messagingSenderId: "711961129196",
    appId: "1:711961129196:web:7e2d2e74539e112dfff5c9"
};

firebase.initializeApp(firebaseConfig);
var db = firebase.database();

var currentUser = {};

/* ==========================
   LOGIN FUNCTION
========================== */

function login(){
  const username = document.getElementById("username").value.trim();
  const role = document.getElementById("roleSelect").value;

  if(!username){
    alert("Masukkan username dulu");
    return;
  }

  currentUser.nama = username;
  currentUser.role = role;

  document.getElementById("loginDiv").style.display = "none";
  document.getElementById("mainDiv").style.display = "block";

  loadRiwayat();
}

/* ==========================
   TAMBAH BARANG MASUK
========================== */

function tambahMasuk(){

  const kode = document.getElementById("kodeMasuk").value.trim();
  const item = document.getElementById("itemMasuk").value.trim();
  const noRR = document.getElementById("noRRMasuk").value.trim();
  const unit = document.getElementById("unitMasuk").value;
  const qty = parseFloat(document.getElementById("qtyMasuk").value);
  const gudang = document.getElementById("gudangMasuk").value;
  const masukStok = document.getElementById("masukStok").checked;

  if(!kode || !item || isNaN(qty)){
    alert("Lengkapi data!");
    return;
  }

  const id = db.ref("transactions").push().key;

  db.ref("transactions/"+id).set({
    tanggal: new Date().toLocaleString(),
    kode: kode,
    item: item,
    noRR: noRR,
    unit: unit,
    qty: qty,
    gudang: gudang,
    masukStok: masukStok,
    user: currentUser.nama
  });

  if(masukStok){
    db.ref("stok/"+kode).once("value").then(snap=>{
      let stokLama = snap.val() || 0;
      db.ref("stok/"+kode).set(stokLama + qty);
    });
  }

  alert("Barang masuk berhasil!");
}

/* ==========================
   LOAD RIWAYAT REALTIME
========================== */

function loadRiwayat(){
  db.ref("transactions").on("value", snap=>{
    const data = snap.val() || {};
    const tabel = document.getElementById("tabelRiwayat");
    tabel.innerHTML = "";

    Object.values(data).forEach(t=>{
      tabel.innerHTML += `
        <tr>
          <td class="border p-2">${t.tanggal}</td>
          <td class="border p-2">${t.gudang}</td>
          <td class="border p-2">${t.kode}</td>
          <td class="border p-2">${t.item}</td>
          <td class="border p-2">${t.qty}</td>
          <td class="border p-2">${t.masukStok ? "Yes" : "No"}</td>
          <td class="border p-2">${t.user}</td>
        </tr>
      `;
    });
  });
}

</script>

</body>
</html>