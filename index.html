<!DOCTYPE html>
<html>
<head>
<meta charset="UTF-8">
<title>Gudang PRO Fix</title>

<script src="https://cdn.tailwindcss.com"></script>
<script src="https://cdn.jsdelivr.net/npm/chart.js"></script>

<script src="https://www.gstatic.com/firebasejs/8.10.1/firebase-app.js"></script>
<script src="https://www.gstatic.com/firebasejs/8.10.1/firebase-database.js"></script>
</head>

<body class="bg-gray-100 p-6">

<h1 class="text-2xl font-bold mb-4">SISTEM GUDANG PRO</h1>

<select id="gudangSelect" class="border p-2 mb-4" onchange="loadBarang()">
<option value="Gudang A">Gudang A</option>
<option value="Gudang B">Gudang B</option>
</select>

<div class="bg-white p-4 rounded shadow mb-4">
<input id="nama" placeholder="Nama Barang" class="border p-2 mr-2">
<input id="stok" type="number" placeholder="Stok" class="border p-2 mr-2">
<input id="minimum" type="number" placeholder="Minimum" class="border p-2 mr-2">
<button onclick="tambahBarang()" class="bg-blue-500 text-white px-4 py-2 rounded">Tambah</button>
</div>

<table class="w-full border bg-white">
<thead>
<tr class="bg-gray-200">
<th class="border p-2">Nama</th>
<th class="border p-2">Stok</th>
<th class="border p-2">Min</th>
<th class="border p-2">Aksi</th>
</tr>
</thead>
<tbody id="tabelBarang"></tbody>
</table>

<br>
<canvas id="chartStok"></canvas>

<script>

var firebaseConfig = {
  apiKey: "AIzaSyAucO3yaRtvL-v9zcK_6-ThNJVt-kRF3jg",
  authDomain: "gudang-anto-2026.firebaseapp.com",
  databaseURL: "https://gudang-anto-2026-default-rtdb.asia-southeast1.firebasedatabase.app",
  projectId: "gudang-anto-2026"
};

firebase.initializeApp(firebaseConfig);
var db = firebase.database();
var chart;

// TAMBAH BARANG
function tambahBarang(){
  var gudang = document.getElementById("gudangSelect").value;
  var nama = document.getElementById("nama").value;
  var stok = parseInt(document.getElementById("stok").value);
  var minimum = parseInt(document.getElementById("minimum").value);

  if(!nama || isNaN(stok) || isNaN(minimum)){
    alert("Isi semua data");
    return;
  }

  var id = Date.now();

  db.ref("barang/"+gudang+"/"+id).set({
    nama:nama,
    stok:stok,
    minimum:minimum
  });

  document.getElementById("nama").value="";
  document.getElementById("stok").value="";
  document.getElementById("minimum").value="";
}

// LOAD DATA
function loadBarang(){
  var gudang = document.getElementById("gudangSelect").value;

  db.ref("barang/"+gudang).on("value", function(snapshot){

    var data = snapshot.val();
    var tabel = document.getElementById("tabelBarang");
    tabel.innerHTML="";

    var labels=[];
    var stokData=[];

    if(!data){
      updateChart([],[]);
      return;
    }

    for(var id in data){

      var row = "<tr>";

      row += "<td class='border p-2'>"+data[id].nama+"</td>";
      row += "<td class='border p-2'>"+data[id].stok+"</td>";
      row += "<td class='border p-2'>"+data[id].minimum+"</td>";
      row += "<td class='border p-2'>";
      row += "<button onclick=\"updateStok('"+id+"','masuk')\" class='bg-green-500 text-white px-2 py-1 rounded mr-1'>+</button>";
      row += "<button onclick=\"updateStok('"+id+"','keluar')\" class='bg-yellow-500 text-white px-2 py-1 rounded'>-</button>";
      row += "</td></tr>";

      tabel.innerHTML += row;

      labels.push(data[id].nama);
      stokData.push(data[id].stok);
    }

    updateChart(labels,stokData);
  });
}

// UPDATE STOK
function updateStok(id,tipe){
  var gudang = document.getElementById("gudangSelect").value;
  var jumlah = parseInt(prompt("Jumlah?"));
  if(isNaN(jumlah)) return;

  var ref = db.ref("barang/"+gudang+"/"+id);

  ref.once("value").then(function(snap){
    var barang = snap.val();
    var stokBaru;

    if(tipe=="masuk"){
      stokBaru = barang.stok + jumlah;
    }else{
      stokBaru = barang.stok - jumlah;
    }

    ref.update({stok:stokBaru});
  });
}

// GRAFIK
function updateChart(labels,data){
  if(chart) chart.destroy();

  chart = new Chart(document.getElementById("chartStok"),{
    type:"bar",
    data:{
      labels:labels,
      datasets:[{
        label:"Stok",
        data:data
      }]
    }
  });
}

loadBarang();

</script>
</body>
</html>