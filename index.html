<!DOCTYPE html>
<html>
<head>
<meta charset="UTF-8">
<title>SISTEM GUDANG ULTIMATE 2.1 TANPA LOGIN</title>

<script src="https://www.gstatic.com/firebasejs/8.10.0/firebase-app.js"></script>
<script src="https://www.gstatic.com/firebasejs/8.10.0/firebase-database.js"></script>
<script src="https://cdn.jsdelivr.net/npm/chart.js"></script>
<script src="https://cdnjs.cloudflare.com/ajax/libs/xlsx/0.18.5/xlsx.full.min.js"></script>

<style>
body{font-family:Arial;margin:20px;background:#f4f6f9}
h2{margin-top:30px}
input,select{padding:6px;margin:4px}
button{padding:6px 10px;margin:4px;border:none;background:#2e7d32;color:white;cursor:pointer}
button.red{background:#c62828}
table{border-collapse:collapse;width:100%;background:white}
th,td{border:1px solid #ccc;padding:6px;text-align:center}
th{background:#2e7d32;color:white}
</style>
</head>
<body>

<h1>SISTEM GUDANG ULTIMATE 2.1</h1>

<h2>Barang Masuk</h2>
<input id="kode" placeholder="Kode Barang">
<input id="item" placeholder="Nama Item">
<input id="supplier" placeholder="Supplier">
<select id="unit">
<option>kg</option><option>meter</option><option>roll</option>
<option>ball</option><option>dos</option><option>box</option>
<option>pcs</option><option>M3</option><option>liter</option>
<option>ton</option><option>tins</option><option>drum</option>
<option>sheet</option><option>ujung</option>
</select>
<input type="number" id="qty" placeholder="Qty">
<select id="gudang">
<option value="ingredients">Gudang Ingredients</option>
<option value="label">Gudang Label</option>
<option value="atk">Gudang ATK</option>
<option value="general_store_a">General Store A</option>
<option value="general_store_b">General Store B</option>
<option value="tambak">Gudang Tambak</option>
</select>
<button onclick="tambahMasuk()">Tambah Masuk</button>

<h2>Barang Keluar</h2>
<input id="kodeKeluar" placeholder="Kode Barang">
<input type="number" id="qtyKeluar" placeholder="Qty">
<select id="gudangKeluar">
<option value="ingredients">Gudang Ingredients</option>
<option value="label">Gudang Label</option>
<option value="atk">Gudang ATK</option>
<option value="general_store_a">General Store A</option>
<option value="general_store_b">General Store B</option>
<option value="tambak">Gudang Tambak</option>
</select>
<button onclick="tambahKeluar()">Tambah Keluar</button>

<h2>Riwayat Transaksi</h2>
<button onclick="exportExcel()">Export Excel</button>
<table>
<thead>
<tr>
<th>Tanggal</th><th>Tipe</th><th>Gudang</th>
<th>Kode</th><th>Item</th><th>Qty</th>
<th>Unit</th><th>Aksi</th>
</tr>
</thead>
<tbody id="tbody"></tbody>
</table>

<h2>Grafik Total Stok</h2>
<canvas id="chart"></canvas>

<script>
var firebaseConfig = {
 apiKey: "AIzaSyAucO3yaRtvL-v9zCK_6-ThNJVT-kRF3jg",
    authDomain: "gudang-anto-2026.firebaseapp.com",
    databaseURL: "https://gudang-anto-2026-default-rtdb.asia-southeast1.firebasedatabase.app",
    projectId: "gudang-anto-2026",
    storageBucket: "gudang-anto-2026.firebasestorage.app",
    messagingSenderId: "711961129196",
    appId: "1:711961129196:web:7e2d2e74539e112dfff5c9"
};

firebase.initializeApp(firebaseConfig);
var db = firebase.database();

function tambahMasuk(){
var data={
tanggal:new Date().toLocaleString(),
tipe:"Masuk",
kode:document.getElementById("kode").value,
item:document.getElementById("item").value,
supplier:document.getElementById("supplier").value,
unit:document.getElementById("unit").value,
qty:Number(document.getElementById("qty").value),
gudang:document.getElementById("gudang").value
};

db.ref("transactions").push(data);

db.ref("stok/"+data.gudang+"/"+data.kode)
.transaction(function(current){
return (current||0)+data.qty;
});
}

function tambahKeluar(){
var data={
tanggal:new Date().toLocaleString(),
tipe:"Keluar",
kode:document.getElementById("kodeKeluar").value,
qty:Number(document.getElementById("qtyKeluar").value),
gudang:document.getElementById("gudangKeluar").value
};

db.ref("transactions").push(data);

db.ref("stok/"+data.gudang+"/"+data.kode)
.transaction(function(current){
return (current||0)-data.qty;
});
}

function loadData(){
db.ref("transactions").on("value",function(snapshot){
var tbody=document.getElementById("tbody");
tbody.innerHTML="";
var stokTotal={};

snapshot.forEach(function(child){
var d=child.val();
var key=child.key;

tbody.innerHTML+=`
<tr>
<td>${d.tanggal}</td>
<td>${d.tipe}</td>
<td>${d.gudang}</td>
<td>${d.kode||""}</td>
<td>${d.item||""}</td>
<td>${d.qty||0}</td>
<td>${d.unit||""}</td>
<td>
<button onclick="editData('${key}')">Edit</button>
<button class="red" onclick="hapusData('${key}')">Hapus</button>
</td>
</tr>
`;

if(!stokTotal[d.gudang]) stokTotal[d.gudang]=0;
if(d.tipe=="Masuk") stokTotal[d.gudang]+=Number(d.qty);
if(d.tipe=="Keluar") stokTotal[d.gudang]-=Number(d.qty);

});

updateChart(stokTotal);
});
}

function hapusData(key){
if(confirm("Hapus transaksi?")){
db.ref("transactions/"+key).remove();
}
}

function editData(key){
var qtyBaru=prompt("Masukkan Qty Baru:");
if(qtyBaru!=null){
db.ref("transactions/"+key+"/qty").set(Number(qtyBaru));
}
}

var chart;
function updateChart(data){
var ctx=document.getElementById("chart").getContext("2d");
var labels=Object.keys(data);
var values=Object.values(data);

if(chart) chart.destroy();

chart=new Chart(ctx,{
type:"bar",
data:{labels:labels,datasets:[{label:"Total Stok",data:values}]}
});
}

function exportExcel(){
db.ref("transactions").once("value").then(function(snapshot){
var data=[];
snapshot.forEach(function(child){data.push(child.val());});
var ws=XLSX.utils.json_to_sheet(data);
var wb=XLSX.utils.book_new();
XLSX.utils.book_append_sheet(wb,ws,"Riwayat");
XLSX.writeFile(wb,"Riwayat_Transaksi.xlsx");
});
}

loadData();
</script>
</body>
</html>